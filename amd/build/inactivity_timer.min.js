define ("local_time_tracking/inactivity_timer",["jquery","core/config","core/modal_factory","core/log"],function(a,b,c,d){var e=function(a,b,c){this.idleThreshold=a;this.sessionTimeout=b;this.sessionTimeoutWarnThreshold=c;this.idleTime=0;this.active=!0;this.warned=!1;this.timeoutModal=null;this.videos={};this.loggedOut=!1;console.log("NEW IT",this)};e.prototype.init=function(){var b=this;a(document).mousemove(function(){b.activate()});a(document).keypress(function(){b.activate()});a(document).scroll(function(){b.activate()});setInterval(function(){b.idleTime=b.idleTime+1e3;if(b.idleTime>=b.idleThreshold){if(b.active){d.debug("INACTIVITY_TIMER: EVENT inactive");a(b).trigger("inactive")}b.active=!1}var c=b.sessionTimeout-b.idleTime/1e3;if(0<b.sessionTimeout&&0>=c){a(b).trigger("session_timeout")}if(0<b.sessionTimeout&&0<b.sessionTimeoutWarnThreshold){var e=b.sessionTimeout-b.sessionTimeoutWarnThreshold;if(!b.warned&&b.idleTime/1e3>=e){a(b).trigger("session_timeout_warn")}}a("video").each(function(c,e){if(!b.videos.hasOwnProperty(e.id)){d.debug("VIDEO DETECTED:  video.id");d.debug(e);b.videos[e.id]=e;a(e).on("timeupdate",function(){b.activate()})}});b.updateTimeoutWarnModal()},1e3);a(this).on("session_timeout_warn",function(){if(b.warned){return}b.warned=!0;b.updateTimeoutWarnModal();b.showTimeoutWarnModal()})};e.prototype.updateTimeoutWarnModal=function(){var a=this.sessionTimeout-this.idleTime/1e3;if(0>a){a=0}if(this.timeoutModal){this.timeoutModal.setBody("You have been inactive and will be logged out in "+a+" seconds.")}};e.prototype.showTimeoutWarnModal=function(){var a=this;this.getTimeoutWarnModal(function(b){if(!b.isVisible()){a.updateTimeoutWarnModal();b.show()}})};e.prototype.hideTimeoutWarnModal=function(){this.getTimeoutWarnModal(function(a){a.hide()})};e.prototype.activate=function(){this.idleTime=0;if(!this.active){a(this).trigger("active")}if(this.timeoutModal&&this.timeoutModal.isVisible()){this.hideTimeoutWarnModal()}this.active=!0;this.warned=!1};e.prototype.getTimeoutWarnModal=function(a){var b=this;if(this.timeoutModal){a(this.timeoutModal);return}c.create({type:c.types.DEFAULT,title:"Inactivity"}).done(function(c){b.timeoutModal=c;a(b.timeoutModal)})};e.prototype.logout=function(a){if(this.loggedOut){return}if(!a){a="You are being logged out due to inactivity. Please login again."}this.loggedOut=!0;alert(a);window.location.href=M.cfg.wwwroot+"/login/logout.php?loginpage=1&sesskey="+M.cfg.sesskey};return e});
//# sourceMappingURL=inactivity_timer.min.js.map
